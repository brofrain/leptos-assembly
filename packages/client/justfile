!include ../../justfile

# @kw simplify? - This command is used by `build.rs` to prepare assets for the browser-side of the app
_prebuild:
    #!/usr/bin/env sh
    npx vite build
    (
        cd ../.. &&
        # Vite does not yield all the files at the same moment, which breaks
        # cargo-leptos' HMR. As a workaround, we generate the assets in a temporary
        # location and then move them where they should be at once.
        rm -r target/client-prebuild || true
        # mkdir --parents target/client-prebuild # @kw
        # This file should not be present along other assets as cargo-leptos then
        # will try to remove it from its own asset dir during HMR, fail in doing so
        # and crash.
        # mv target/tmp-client-prebuild/bindings.mjs target/client-prebuild/bindings.mjs # @kw
        mv target/tmp-client-prebuild target/client-prebuild
    )
